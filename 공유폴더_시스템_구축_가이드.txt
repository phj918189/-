# ê³µìœ í´ë” ê¸°ë°˜ EIMS ìë™í™” ì‹œìŠ¤í…œ êµ¬ì¶• ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”
íšŒì‚¬ ê³µìœ í´ë”ë¥¼ í™œìš©í•œ EIMS ìë™í™” ì‹œìŠ¤í…œ êµ¬ì¶• ë°©ë²•
- ê¸°ì¡´ ì¸í”„ë¼ í™œìš© (ì¶”ê°€ ë¹„ìš© ì—†ìŒ)
- ë‹´ë‹¹ìë³„ ì‘ì—… ë¶„ë°°
- ì‹¤ì‹œê°„ ëŒ€ì‹œë³´ë“œ ì œê³µ

## ğŸ—ï¸ ì‹œìŠ¤í…œ êµ¬ì¡°

### ê³µìœ í´ë” êµ¬ì¡°
```
//server/shared/eims_automation/
â”œâ”€â”€ ğŸ“ assignments/              # ë‹´ë‹¹ìë³„ ì‘ì—… í´ë”
â”‚   â”œâ”€â”€ ğŸ“ ê¹€ì—°êµ¬ì›/
â”‚   â”‚   â”œâ”€â”€ ğŸ“ today/           # ì˜¤ëŠ˜ ë°°ì •ëœ ì‘ì—…
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ 20251020/    # ë‚ ì§œë³„ í´ë”
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ assignments_20251020.csv
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ summary_20251020.txt
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ assignments_20251020.xlsx
â”‚   â”‚   â”œâ”€â”€ ğŸ“ pending/         # ëŒ€ê¸° ì¤‘ì¸ ì‘ì—…
â”‚   â”‚   â”œâ”€â”€ ğŸ“ completed/      # ì™„ë£Œëœ ì‘ì—…
â”‚   â”‚   â””â”€â”€ ğŸ“„ README.md       # ë‹´ë‹¹ìë³„ ì•ˆë‚´
â”‚   â””â”€â”€ ğŸ“ ë°•ì—°êµ¬ì›/
â”œâ”€â”€ ğŸ“ system/                   # ì‹œìŠ¤í…œ íŒŒì¼
â”‚   â”œâ”€â”€ ğŸ“ scripts/             # ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ë“¤
â”‚   â”œâ”€â”€ ğŸ“ config/              # ì„¤ì • íŒŒì¼ë“¤
â”‚   â””â”€â”€ ğŸ“ logs/                # ì‹œìŠ¤í…œ ë¡œê·¸
â”œâ”€â”€ ğŸ“ data/                    # ë°ì´í„° ì €ì¥ì†Œ
â”‚   â”œâ”€â”€ ğŸ“ downloads/           # ë‹¤ìš´ë¡œë“œëœ ì—‘ì…€ íŒŒì¼
â”‚   â”œâ”€â”€ ğŸ“ backups/             # ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
â”‚   â””â”€â”€ ğŸ“„ lab.db               # SQLite ë°ì´í„°ë² ì´ìŠ¤
â”œâ”€â”€ ğŸ“ reports/                 # ë¶„ì„ ë³´ê³ ì„œ
â”œâ”€â”€ ğŸ“„ dashboard.html           # ì „ì²´ í˜„í™© ëŒ€ì‹œë³´ë“œ
â”œâ”€â”€ ğŸ“„ run_eims.bat            # ì‹œìŠ¤í…œ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸
â”œâ”€â”€ ğŸ“„ ì‚¬ìš©ì_ê°€ì´ë“œ.md         # ì‚¬ìš©ë²• ì•ˆë‚´
â””â”€â”€ ğŸ“„ ê´€ë¦¬ì_ë§¤ë‰´ì–¼.md         # ê´€ë¦¬ììš© ë§¤ë‰´ì–¼
```

## ğŸš€ êµ¬ì¶• ë‹¨ê³„

### 1ë‹¨ê³„: í´ë” êµ¬ì¡° ìƒì„±
```python
# shared_folder_structure.py
class SharedFolderStructure:
    def __init__(self, shared_path="//server/shared/eims_automation"):
        self.shared_path = Path(shared_path)
    
    def create_folder_structure(self):
        # ë©”ì¸ í´ë”ë“¤ ìƒì„±
        folders = ["assignments", "system", "data", "reports"]
        for folder in folders:
            (self.shared_path / folder).mkdir(parents=True, exist_ok=True)
        
        # í•˜ìœ„ í´ë”ë“¤ ìƒì„±
        subfolders = {
            "system": ["scripts", "config", "logs"],
            "data": ["downloads", "backups"]
        }
        
        for main_folder, subs in subfolders.items():
            for sub in subs:
                (self.shared_path / main_folder / sub).mkdir(parents=True, exist_ok=True)
```

### 2ë‹¨ê³„: íŒŒì¼ ë°°í¬
```python
# shared_folder_deployer.py
class SharedFolderDeployer:
    def deploy_core_files(self):
        # ë°°í¬í•  íŒŒì¼ ëª©ë¡
        files_to_deploy = {
            "sql/job.py": "system/scripts/",
            "scripts/normalize.py": "system/scripts/",
            "scripts/assign.py": "system/scripts/",
            "scripts/notify.py": "system/scripts/",
            "scripts/db.py": "system/scripts/",
            "scripts/cleanup.py": "system/scripts/",
            "config.yaml": "system/config/",
            "README.md": "system/"
        }
        
        for src_file, dst_folder in files_to_deploy.items():
            src_path = self.local_project / src_file
            dst_path = self.shared_path / dst_folder / Path(src_file).name
            shutil.copy2(src_path, dst_path)
```

### 3ë‹¨ê³„: ë‹´ë‹¹ìë³„ í´ë” ìƒì„±
```python
def create_researcher_folders(self):
    # ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì—°êµ¬ì› ëª©ë¡ ì¡°íšŒ
    conn = sqlite3.connect(self.db_path)
    researchers = pd.read_sql_query("""
        SELECT DISTINCT researcher 
        FROM assignments 
        WHERE researcher IS NOT NULL
        ORDER BY researcher
    """, conn)
    conn.close()
    
    for researcher in researchers['researcher'].tolist():
        researcher_folder = self.shared_path / "assignments" / researcher
        researcher_folder.mkdir(parents=True, exist_ok=True)
        
        # í•˜ìœ„ í´ë”ë“¤ ìƒì„±
        subfolders = ["today", "pending", "completed", "reports"]
        for subfolder in subfolders:
            (researcher_folder / subfolder).mkdir(exist_ok=True)
```

### 4ë‹¨ê³„: ë°ì´í„° ë¶„ë°° ì‹œìŠ¤í…œ
```python
# assignment_distributor.py
class AssignmentDistributor:
    def distribute_today_assignments(self):
        # ì˜¤ëŠ˜ ë°°ì •ëœ ì‘ì—… ì¡°íšŒ
        assignments = pd.read_sql_query("""
            SELECT 
                a.researcher,
                a.sample_no,
                a.item,
                a.assigned_at,
                s.site_name,
                s.collected_at,
                s.status
            FROM assignments a
            JOIN samples s ON a.sample_no = s.sample_no
            WHERE date(a.assigned_at) = date('now', 'localtime')
            ORDER BY a.researcher, a.assigned_at
        """, conn)
        
        # ë‹´ë‹¹ìë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ íŒŒì¼ ìƒì„±
        for researcher in assignments['researcher'].unique():
            researcher_data = assignments[assignments['researcher'] == researcher]
            researcher_folder = self.assignments_folder / researcher / "today"
            
            # ì˜¤ëŠ˜ ë‚ ì§œë¡œ í´ë” ì •ë¦¬
            today_folder = researcher_folder / datetime.now().strftime('%Y%m%d')
            today_folder.mkdir(parents=True, exist_ok=True)
            
            # CSV íŒŒì¼ ìƒì„±
            csv_path = today_folder / f"assignments_{datetime.now().strftime('%Y%m%d')}.csv"
            researcher_data.to_csv(csv_path, index=False, encoding='utf-8-sig')
            
            # ìš”ì•½ ë³´ê³ ì„œ ìƒì„±
            summary_path = today_folder / f"summary_{datetime.now().strftime('%Y%m%d')}.txt"
            with open(summary_path, 'w', encoding='utf-8') as f:
                f.write(f"=== {researcher} ë‹´ë‹¹ ì‘ì—… ìš”ì•½ ===\n")
                f.write(f"ë°°ì •ì¼: {datetime.now().strftime('%Y-%m-%d')}\n")
                f.write(f"ì´ ì‘ì—… ìˆ˜: {len(researcher_data)}ê±´\n\n")
                
                # ì¸¡ì •í•­ëª©ë³„ í†µê³„
                item_counts = researcher_data['item'].value_counts()
                f.write("ğŸ“Š ì¸¡ì •í•­ëª©ë³„ ì‘ì—… ìˆ˜:\n")
                for item, count in item_counts.items():
                    f.write(f"  - {item}: {count}ê±´\n")
```

### 5ë‹¨ê³„: ëŒ€ì‹œë³´ë“œ ìƒì„±
```python
def create_dashboard(self):
    # ì „ì²´ í˜„í™© ì¡°íšŒ
    dashboard_data = pd.read_sql_query("""
        SELECT 
            researcher,
            COUNT(*) as total_assignments,
            COUNT(CASE WHEN date(assigned_at) = date('now', 'localtime') THEN 1 END) as today_assignments
        FROM assignments 
        GROUP BY researcher
        ORDER BY total_assignments DESC
    """, conn)
    
    # HTML ëŒ€ì‹œë³´ë“œ ìƒì„±
    html_content = f"""<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>EIMS ì‘ì—… ë°°ì • í˜„í™©</title>
    <style>
        body {{ font-family: Arial, sans-serif; margin: 20px; }}
        table {{ border-collapse: collapse; width: 100%; }}
        th, td {{ border: 1px solid #ddd; padding: 8px; text-align: left; }}
        th {{ background-color: #f2f2f2; }}
        .today {{ background-color: #e8f5e8; }}
    </style>
</head>
<body>
    <h1>ğŸ“Š EIMS ì‘ì—… ë°°ì • í˜„í™©</h1>
    
    <h2>ğŸ‘¥ ë‹´ë‹¹ìë³„ í˜„í™©</h2>
    <table>
        <tr>
            <th>ë‹´ë‹¹ì</th>
            <th>ì´ ì‘ì—… ìˆ˜</th>
            <th>ì˜¤ëŠ˜ ì‘ì—… ìˆ˜</th>
            <th>ì‘ì—… í´ë”</th>
        </tr>
"""
    
    for _, row in dashboard_data.iterrows():
        researcher = row['researcher']
        html_content += f"""
        <tr class="{'today' if row['today_assignments'] > 0 else ''}">
            <td>{researcher}</td>
            <td>{row['total_assignments']}ê±´</td>
            <td>{row['today_assignments']}ê±´</td>
            <td><a href="assignments/{researcher}/">ğŸ“ í´ë” ì—´ê¸°</a></td>
        </tr>
"""
    
    html_content += """
    </table>
</body>
</html>
"""
    
    # HTML íŒŒì¼ ì €ì¥
    dashboard_path = self.shared_path / "dashboard.html"
    with open(dashboard_path, 'w', encoding='utf-8') as f:
        f.write(html_content)
```

## âš™ï¸ ì„¤ì • ë°©ë²•

### 1. í™˜ê²½ë³€ìˆ˜ ì„¤ì •
`//server/shared/eims_automation/system/config/.env` íŒŒì¼ ìƒì„±:
```env
EIMS_ID=your_username
EIMS_PW=your_password
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
MAIL_FROM=your_email@gmail.com
```

### 2. Windows ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì •
- ì‘ì—… ìŠ¤ì¼€ì¤„ëŸ¬ ì—´ê¸°
- ê¸°ë³¸ ì‘ì—… ë§Œë“¤ê¸°
- íŠ¸ë¦¬ê±°: ë§¤ì¼ ì˜¤ì „ 9ì‹œ
- ì‘ì—…: `//server/shared/eims_automation/run_eims.bat` ì‹¤í–‰

### 3. ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
```batch
@echo off
chcp 65001 >nul
REM EIMS ìë™í™” ì‹œìŠ¤í…œ ì‹¤í–‰ ìŠ¤í¬ë¦½íŠ¸

echo ========================================
echo    EIMS ìë™í™” ì‹œìŠ¤í…œ ì‹œì‘
echo ========================================

REM í˜„ì¬ ë””ë ‰í† ë¦¬ë¥¼ ìŠ¤í¬ë¦½íŠ¸ ìœ„ì¹˜ë¡œ ë³€ê²½
cd /d "%~dp0"

REM Python í™˜ê²½ í™•ì¸
python --version >nul 2>&1
if errorlevel 1 (
    echo [ERROR] Pythonì´ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
    pause
    exit /b 1
)

REM ì˜ì¡´ì„± ì„¤ì¹˜ í™•ì¸
echo [INFO] ì˜ì¡´ì„± íŒ¨í‚¤ì§€ í™•ì¸ ì¤‘...
pip install -r system/requirements.txt --quiet

REM í™˜ê²½ë³€ìˆ˜ íŒŒì¼ í™•ì¸
if not exist "system/config/.env" (
    echo [WARNING] í™˜ê²½ë³€ìˆ˜ íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.
    pause
    exit /b 1
)

REM ë©”ì¸ í”„ë¡œì„¸ìŠ¤ ì‹¤í–‰
echo [INFO] EIMS ìë™í™” í”„ë¡œì„¸ìŠ¤ ì‹œì‘...
python system/scripts/job.py

REM ì‘ì—… ë°°ì • ë¶„ë°°
echo [INFO] ë‹´ë‹¹ìë³„ ì‘ì—… ë¶„ë°° ì¤‘...
python system/scripts/assignment_distributor.py

REM ëŒ€ì‹œë³´ë“œ ìƒì„±
echo [INFO] ëŒ€ì‹œë³´ë“œ ìƒì„± ì¤‘...
python system/scripts/dashboard_generator.py

echo ì‘ì—…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
pause
```

## ğŸ‘¥ ì‚¬ìš©ìë³„ ì ‘ê·¼ ë°©ë²•

### ë‹´ë‹¹ì (ì¼ë°˜ ì‚¬ìš©ì)
1. `//server/shared/eims_automation/assignments/ë³¸ì¸ì´ë¦„/today/` í´ë” ì—´ê¸°
2. ì˜¤ëŠ˜ ë°°ì •ëœ ì‘ì—… íŒŒì¼ í™•ì¸:
   - `assignments_YYYYMMDD.csv`: ìƒì„¸ ì‘ì—… ëª©ë¡
   - `summary_YYYYMMDD.txt`: ì‘ì—… ìš”ì•½
   - `assignments_YYYYMMDD.xlsx`: ì—‘ì…€ íŒŒì¼
3. ì‘ì—… ì™„ë£Œ í›„ `completed/` í´ë”ë¡œ ì´ë™
4. í•„ìš”ì‹œ ë³´ê³ ì„œë¥¼ `reports/` í´ë”ì— ì €ì¥

### ê´€ë¦¬ì
1. `//server/shared/eims_automation/dashboard.html` ë¸Œë¼ìš°ì €ì—ì„œ ì—´ê¸°
2. ì „ì²´ í˜„í™© í™•ì¸:
   - ë‹´ë‹¹ìë³„ ì‘ì—… í˜„í™©
   - ìµœê·¼ ë°°ì • ë‚´ì—­
   - ì „ì²´ í†µê³„
3. í•„ìš”ì‹œ `run_eims.bat` ìˆ˜ë™ ì‹¤í–‰
4. ì‹œìŠ¤í…œ ë¡œê·¸ í™•ì¸: `system/logs/app.log`

## ğŸ”§ ì‹¤í–‰ ìˆœì„œ

### 1ë‹¨ê³„: ì¤€ë¹„ ì‘ì—…
```bash
# í˜„ì¬ í”„ë¡œì íŠ¸ì—ì„œ ì‹¤í–‰
python shared_folder_structure.py
```

### 2ë‹¨ê³„: ì „ì²´ ë°°í¬
```bash
# ê³µìœ í´ë”ì— ëª¨ë“  íŒŒì¼ ë°°í¬
python shared_folder_deployer.py
```

### 3ë‹¨ê³„: í†µí•© ì‹¤í–‰
```bash
# ì „ì²´ ì‹œìŠ¤í…œ ì‹¤í–‰ (ë°°í¬ + í”„ë¡œì„¸ìŠ¤ + ë¶„ë°°)
python run_shared_deployment.py
```

## ğŸ“Š ì¥ë‹¨ì  ë¹„êµ

### ê³µìœ í´ë” ë°©ì‹ (í˜„ì¬)
#### ì¥ì :
- âœ… ê¸°ì¡´ ì¸í”„ë¼ í™œìš©
- âœ… ì¶”ê°€ ë¹„ìš© ì—†ìŒ
- âœ… íšŒì‚¬ ë‚´ë¶€ ë„¤íŠ¸ì›Œí¬ì—ì„œ ë¹ ë¥¸ ì ‘ê·¼
- âœ… IT ì •ì±…ê³¼ ì¼ì¹˜

#### ë‹¨ì :
- âŒ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì–´ë ¤ì›€
- âŒ ë™ì‹œ ì ‘ê·¼ ì‹œ ì¶©ëŒ ê°€ëŠ¥ì„±
- âŒ ì™¸ë¶€ ì ‘ê·¼ ë¶ˆê°€
- âŒ ë²„ì „ ê´€ë¦¬ ì–´ë ¤ì›€

### í–¥í›„ ê°œì„  ë°©í–¥
1. **3ê°œì›” í›„**: ì›¹ ëŒ€ì‹œë³´ë“œ êµ¬ì¶•
2. **6ê°œì›” í›„**: í´ë¼ìš°ë“œ ì´ì „ ê²€í† 
3. **1ë…„ í›„**: ëª¨ë°”ì¼ ì•± ê°œë°œ

## ğŸš¨ ì£¼ì˜ì‚¬í•­

1. **íŒŒì¼ ìˆ˜ì • ê¸ˆì§€**: `system/` í´ë”ì˜ íŒŒì¼ì€ ìˆ˜ì •í•˜ì§€ ë§ˆì„¸ìš”
2. **ì •ê¸° ì‹¤í–‰**: ë§¤ì¼ ì˜¤ì „ì— ì‹œìŠ¤í…œì„ ì‹¤í–‰í•´ì£¼ì„¸ìš”
3. **ë°±ì—… í™•ì¸**: ì¤‘ìš”í•œ ë°ì´í„°ëŠ” ë³„ë„ ë°±ì—…í•˜ì„¸ìš”
4. **ë³´ì•ˆ**: ë¡œê·¸ì¸ ì •ë³´ëŠ” ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•˜ì„¸ìš”
5. **ë™ì‹œ ì ‘ê·¼**: ì—¬ëŸ¬ ëª…ì´ ë™ì‹œì— íŒŒì¼ì„ ìˆ˜ì •í•˜ì§€ ë§ˆì„¸ìš”

## ğŸ“ ë¬¸ì˜ ë° ì§€ì›

### ì‹œìŠ¤í…œ ë¬¸ì˜
- **ITíŒ€**: ì‹œìŠ¤í…œ ì˜¤ë¥˜, ì ‘ê·¼ ê¶Œí•œ ë¬¸ì œ
- **ê°œë°œíŒ€**: ê¸°ëŠ¥ ê°œì„ , ìƒˆë¡œìš´ ìš”êµ¬ì‚¬í•­

### ì‘ì—… ë¬¸ì˜
- **ë‹´ë‹¹ ê´€ë¦¬ì**: ì‘ì—… ë‚´ìš©, ìš°ì„ ìˆœìœ„
- **ì—°êµ¬íŒ€ì¥**: ì „ì²´ ì‘ì—… ë¶„ë°°, ì¼ì • ì¡°ì •

---
*ì‘ì„±ì¼: 2025-10-20*
*ë¬¸ì„œ ë²„ì „: 1.0*
*ì‘ì„±ì: ë°•í˜ì§„*
