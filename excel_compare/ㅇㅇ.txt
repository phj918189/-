exeì— ë¹Œë“œ
python -m PyInstaller --noconsole --onefile excel_compare_app.py


ê·¸ëŸ°ë° ë°©ë²•ì„ ì¢€ ë°”ê¿€êº¼ì•¼. 
ì§€ê¸ˆì€ í”„ë¡œì íŠ¸ ê²½ë¡œì— ë¹„êµ í•  ë‘ê°œì˜ íŒŒì¼ì„ ë‘ê³  ì½”ë“œìƒì—ì„œ ë¹„êµí•˜ì—¬ ìƒˆë¡œìš´ ì—‘ì…€ íŒŒì¼ ìƒì„±í•˜ê³  ìˆìŒ.

ê·¸ëŸ¬ë‚˜ ë³€ê²½í•˜ê³  ì‹¶ì€ ë°©ë²•ì€
ìš°ì„  ë¹„êµí•˜ëŠ” ì—­í• ì„ ìˆ˜í–‰í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ ë§Œë“¤ê³  ê·¸ ì•ˆì—ì„œ ì›í•˜ëŠ” ë‘ íŒŒì¼ë“¤ì„ ì„ íƒ í•œí›„ ë¹„êµí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•˜ê³  ì‹¶ìŒ.
ì˜ˆë¥¼ ë“¤ë©´ ì²«ë²ˆì§¸ íŒŒì¼ì˜ ê° ì…€ë“¤ì´ ë‘ë²ˆì§¸ íŒŒì¼ì˜ ì…€ë“¤ì˜ ë‚´ìš©ê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ íŒë‹¨í•˜ë ¤ê³  í•¨. 

ë§Œì•½ ì¼ì¹˜í•˜ë©´ ê¸°ì¡´ ë°°ê²½ìƒ‰ ìœ ì§€, ë¶ˆì¼ì¹˜ í•˜ë©´ ì´ˆë¡ìƒ‰ìœ¼ë¡œ í•´ë‹¹ ì…€ë§Œ ë°°ê²½ìƒ‰ ë³€ê²½í•  ìˆ˜ ìˆë„ë¡ í•´ì•¼ê² ìŒ.



import pandas as pd
from openpyxl import load_workbook
from openpyxl.styles import PatternFill
from tkinter import Tk, filedialog
import os

def select_file(title="ì—‘ì…€ íŒŒì¼ ì„ íƒ"):
    """íŒŒì¼ ì„ íƒì°½ ì—´ê¸°"""
    path = filedialog.askopenfilename(
        title=title,
        filetypes=[("Excel files", "*.xls *.xlsx")]
    )
    return path

def compare_excel_files(file1, file2, output="ë¹„êµê²°ê³¼.xlsx"):
    # íŒŒì¼ ì½ê¸°
    a = pd.read_excel(file1, sheet_name=0, dtype=str).fillna("")
    b = pd.read_excel(file2, sheet_name=0, dtype=str).fillna("")

    # í¬ê¸° í†µì¼
    max_rows = max(a.shape[0], b.shape[0])
    max_cols = max(a.shape[1], b.shape[1])

    # ì²« ë²ˆì§¸ íŒŒì¼ì„ ë³µì‚¬í•´ ê¸°ì¤€ìœ¼ë¡œ ì‚¬ìš©
    a.to_excel(output, index=False)
    wb = load_workbook(output)
    ws = wb.active

    # ìƒ‰ìƒ ì •ì˜
    green = PatternFill(start_color="00FF00", end_color="00FF00", fill_type="solid")

    # ì…€ ë‹¨ìœ„ ë¹„êµ
    for i in range(max_rows):
        for j in range(max_cols):
            val_a = str(a.iat[i, j]) if i < len(a.index) and j < len(a.columns) else ""
            val_b = str(b.iat[i, j]) if i < len(b.index) and j < len(b.columns) else ""

            if val_a != val_b:
                ws.cell(row=i + 2, column=j + 1).fill = green  # í—¤ë” ì•„ë˜ë¶€í„° ìƒ‰ìƒ ë³€ê²½

    wb.save(output)
    print(f"âœ… ë¹„êµ ì™„ë£Œ: {output}")
    print("   - ì´ˆë¡ìƒ‰: ê°’ì´ ë¶ˆì¼ì¹˜í•œ ì…€")

def main():
    root = Tk()
    root.withdraw()  # Tk ì°½ ìˆ¨ê¹€

    print("=== ì—‘ì…€ íŒŒì¼ ë¹„êµ í”„ë¡œê·¸ë¨ ===")
    file1 = select_file("ì²« ë²ˆì§¸ íŒŒì¼(ê¸°ì¤€ íŒŒì¼)ì„ ì„ íƒí•˜ì„¸ìš”")
    if not file1:
        print("âŒ ì²« ë²ˆì§¸ íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
        return
    file2 = select_file("ë‘ ë²ˆì§¸ íŒŒì¼(ë¹„êµ ëŒ€ìƒ íŒŒì¼)ì„ ì„ íƒí•˜ì„¸ìš”")
    if not file2:
        print("âŒ ë‘ ë²ˆì§¸ íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
        return

    print("\nğŸ“ ê¸°ì¤€ íŒŒì¼:", os.path.basename(file1))
    print("ğŸ“ ë¹„êµ ëŒ€ìƒ:", os.path.basename(file2))
    compare_excel_files(file1, file2)

if __name__ == "__main__":
    main()


í„°ë¯¸ë„ì˜ bashì—ì„œ python excel_compare.pyë¥¼ ì‹¤í–‰í•´ì„œ íŒŒì¼ì„ ë¹„êµí•˜ê³  ìˆëŠ”ë°, 
ì´ê²ƒë³´ë‹¤ ë¹„êµ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” í”„ë¡œê·¸ë¨ì„ í•˜ë‚˜ ë§Œë“¤ì–´ì„œ ê·¸ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ì—¬ ë‘ íŒŒì¼ ì„ íƒí›„ ë¹„êµí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì§„í–‰í•˜ê³  ì‹¶ì–´. 
ì§€ê¸ˆì˜ ë°©ì‹ì€ ë¹„êµí•  ì—…ë¬´ê°€ ë°œìƒí•˜ë©´ ë§¤ë²ˆ ì½”ë“œë¥¼ ì‹¤í–‰í•´ì•¼ í•˜ëŠ” ë²ˆê±°ë¡œì›€ì´ ìˆì–´ì„œ ë„ˆë¬´ ë¶ˆí¸í•¨. 


ì§€ê¸ˆì€ í”„ë¡œê·¸ë¨ì˜ íŒŒì¼ ì„ íƒ ë° ë¹„êµ ì‹œì‘ ë²„íŠ¼ì„ í´ë¦­í•´ì„œ ë‘ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¨ í›„ ë¹„êµë¥¼ ì§„í–‰í•˜ê³  ìˆì–´. 
ê·¸ëŸ¬ë‚˜ ë‚´ê°€ ì›í•˜ëŠ” ê±´ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ë©´ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ë©´ ê·¸ íŒŒì¼ì´ í”„ë¡œê·¸ë¨ ìƒì—ì„œ ì—´ë ¤ ìˆì–´ì•¼ í•´. 
ê·¸ë ‡ê²Œ ë‘ íŒŒì¼ì„ ëª¨ë‘ ë¶ˆëŸ¬ì™€ì„œ ì—´ì–´ ë†“ê³  ë¹„êµ ì‹œì‘ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹¤í–‰í•˜ê³  ì‹¶ì–´. 

ì´ë ‡ê²Œ ì§„í–‰ í•  ê²½ìš° ë¹„êµ íŒŒì¼ì„ ìƒì„± í•˜ì§€ ì•Šê³ ì„œë„ ë‘ íŒŒì¼ì˜ ë‹¤ë¥¸ ë‚´ìš©ì„ í™•ì¸ í•  ìˆ˜ ìˆì–´. 
ê·¸ë¦¬ê³  ë„ˆê°€ ì°¸ê³  í•´ì•¼ í•  ê²ƒì€ ê° ì…€ë“¤ì˜ ì‚¬ì´ì¦ˆë„ ì •í™•íˆ í™•ì¸ í•´ì•¼ ë¼. 
ì§€ê¸ˆê¹Œì§€ ë„ˆê°€ ë§Œë“¤ì–´ì¤€ ì½”ë“œëŠ” ì¤„ë°”ê¿ˆ ë˜ì–´ ìˆëŠ” í…ìŠ¤íŠ¸ì—ì„œ ë§¨ ìœ—ì¤„ í…ìŠ¤íŠ¸ë§Œ ë³´ì—¬ì£¼ê³  ì•„ë«ì¤„ì€ ì•„ì˜ˆ ë³´ì—¬ì£¼ì§€ ì•Šê³  ìˆì–´. 




ì»¤ì„œì—ì„œ ìµœì¢…ì„. 
ì‹¤í–‰ ëª…ë ¹ì–´
python excel_compare_app.py

import tkinter as tk
from tkinter import filedialog, messagebox
from tksheet import Sheet
import pandas as pd

class ExcelComparatorApp:
    def __init__(self, root):
        self.root = root
        self.root.title("ì—‘ì…€ ë¹„êµ ë·°ì–´")
        self.root.geometry("1700x850")

        self.df_left = None
        self.df_right = None

        # ì¬ì§„ì… ë°©ì§€ í”Œë˜ê·¸
        self._syncing_scroll = False
        self._syncing_select = False

        # â”€â”€ ìƒë‹¨ UI â”€â”€
        top = tk.Frame(root)
        top.pack(pady=10)

        tk.Button(top, text="ğŸ“‚ ì²« ë²ˆì§¸ íŒŒì¼ ì—´ê¸°", command=self.load_left,
                  bg="#3C91E6", fg="white", width=20).grid(row=0, column=0, padx=8)
        tk.Button(top, text="ğŸ“‚ ë‘ ë²ˆì§¸ íŒŒì¼ ì—´ê¸°", command=self.load_right,
                  bg="#3C91E6", fg="white", width=20).grid(row=0, column=1, padx=8)
        tk.Button(top, text="ğŸ” ë¹„êµ ì‹œì‘", command=self.compare_files,
                  bg="#4CAF50", fg="white", width=18).grid(row=0, column=2, padx=8)

        # â”€â”€ ì‹œíŠ¸ ì˜ì—­ â”€â”€
        frame = tk.Frame(root)
        frame.pack(padx=10, pady=10, fill="both", expand=True)

        self.left_sheet = Sheet(frame, width=830, height=720)
        self.right_sheet = Sheet(frame, width=830, height=720)
        self.left_sheet.grid(row=0, column=0, sticky="nsew", padx=5)
        self.right_sheet.grid(row=0, column=1, sticky="nsew", padx=5)

        frame.grid_rowconfigure(0, weight=1)
        frame.grid_columnconfigure(0, weight=1)
        frame.grid_columnconfigure(1, weight=1)

        # ìŠ¤í¬ë¡¤/ì„ íƒ ë™ê¸°í™” ì„¤ì¹˜
        self._install_sync_scroll()
        self._install_sync_selection()

    @staticmethod
    def _generate_excel_column_headers(num_columns):
        # 1-based to Excel letters (A, B, ... Z, AA, AB ...)
        headers = []
        for i in range(1, num_columns + 1):
            n = i
            s = ""
            while n > 0:
                n, rem = divmod(n - 1, 26)
                s = chr(65 + rem) + s
            headers.append(s)
        return headers

    @staticmethod
    def _to_b2_region(df):
        # ê°•ì œ B2 ì˜ì—­ìœ¼ë¡œ ìë¥´ê¸°: ì²« í–‰/ì²« ì—´ ì œê±° í›„ ì¸ë±ìŠ¤ ë¦¬ì…‹
        cropped = df.iloc[1:, 1:]
        # ì™„ì „íˆ ë¹„ì–´ìˆëŠ” í–‰/ì—´ ì œê±°(ì—‘ì…€ ë³‘í•© ì”ì—¬ ê³µë°± ë°©ì§€)
        cropped = cropped.dropna(how="all", axis=0)
        cropped = cropped.dropna(how="all", axis=1)
        return cropped.reset_index(drop=True)

    # =============== ìŠ¤í¬ë¡¤ ë™ê¸°í™” ===============
    def _install_sync_scroll(self):
        # ì›ë˜ yview/xview ë³´ê´€
        self._left_yview_orig  = self.left_sheet.MT.yview
        self._right_yview_orig = self.right_sheet.MT.yview
        self._left_xview_orig  = self.left_sheet.MT.xview
        self._right_xview_orig = self.right_sheet.MT.xview

        def left_yview_proxy(*args):
            # ë¨¼ì € ì™¼ìª½ì„ ì •ìƒ ìŠ¤í¬ë¡¤
            self._left_yview_orig(*args)
            # í˜„ì¬ ìœ„ì¹˜ ì½ê¸° (ì‹œì‘ fraction)
            try:
                start, _ = self.left_sheet.MT.yview()
            except Exception:
                return
            # ì¬ì§„ì… ë°©ì§€ í›„ ìš°ì¸¡ì„ ë™ì¼ ìœ„ì¹˜ë¡œ ì´ë™
            if not self._syncing_scroll:
                self._syncing_scroll = True
                try:
                    self.right_sheet.MT.yview_moveto(start)
                finally:
                    self._syncing_scroll = False

        def right_yview_proxy(*args):
            self._right_yview_orig(*args)
            try:
                start, _ = self.right_sheet.MT.yview()
            except Exception:
                return
            if not self._syncing_scroll:
                self._syncing_scroll = True
                try:
                    self.left_sheet.MT.yview_moveto(start)
                finally:
                    self._syncing_scroll = False

        def left_xview_proxy(*args):
            self._left_xview_orig(*args)
            try:
                start, _ = self.left_sheet.MT.xview()
            except Exception:
                return
            if not self._syncing_scroll:
                self._syncing_scroll = True
                try:
                    self.right_sheet.MT.xview_moveto(start)
                finally:
                    self._syncing_scroll = False

        def right_xview_proxy(*args):
            self._right_xview_orig(*args)
            try:
                start, _ = self.right_sheet.MT.xview()
            except Exception:
                return
            if not self._syncing_scroll:
                self._syncing_scroll = True
                try:
                    self.left_sheet.MT.xview_moveto(start)
                finally:
                    self._syncing_scroll = False

        # ë©”ì„œë“œ í›„í‚¹
        self.left_sheet.MT.yview  = left_yview_proxy
        self.right_sheet.MT.yview = right_yview_proxy
        self.left_sheet.MT.xview  = left_xview_proxy
        self.right_sheet.MT.xview = right_xview_proxy

    # =============== ì…€ ì„ íƒ ë™ê¸°í™” ===============
    def _install_sync_selection(self):
        # í˜„ì¬ ì„ íƒëœ ì…€ì„ ì½ì–´ì„œ ë°˜ëŒ€í¸ì— ë°˜ì˜
        def sync_from_to(source_sheet, target_sheet):
            if self._syncing_select:
                return
            try:
                selected = source_sheet.get_currently_selected()
            except Exception:
                selected = None
            if not selected:
                return
            # tksheetëŠ” (row, column) ë˜ëŠ” (row, column, type) ë°˜í™˜ ê°€ëŠ¥
            r = selected[0] if isinstance(selected, (list, tuple)) and len(selected) >= 1 else None
            c = selected[1] if isinstance(selected, (list, tuple)) and len(selected) >= 2 else None
            if r is None or c is None:
                return
            self._syncing_select = True
            try:
                # ê¸°ì¡´ ë¹„êµ í•˜ì´ë¼ì´íŠ¸(ì´ˆë¡ìƒ‰)ë¥¼ ë³´ì¡´í•˜ê¸° ìœ„í•´ ì „ì²´ ë””í•˜ì´ë¼ì´íŠ¸ëŠ” í•˜ì§€ ì•ŠëŠ”ë‹¤
                target_sheet.select_cell(r, c, redraw=True)
                # ë³´ì´ë„ë¡ ìŠ¤í¬ë¡¤ ì¡°ì •
                try:
                    top, bottom = target_sheet.MT.yview()
                    total_rows = max(1, target_sheet.MT.get_total_rows())
                    if not (top * total_rows <= r <= bottom * total_rows):
                        vis_rows = max(1, int((bottom - top) * total_rows))
                        frac = max(0.0, min(1.0, (r - vis_rows/2) / total_rows))
                        target_sheet.MT.yview_moveto(frac)
                    lft, rgt = target_sheet.MT.xview()
                    total_cols = max(1, target_sheet.MT.get_total_columns())
                    if not (lft * total_cols <= c <= rgt * total_cols):
                        vis_cols = max(1, int((rgt - lft) * total_cols))
                        fracx = max(0.0, min(1.0, (c - vis_cols/2) / total_cols))
                        target_sheet.MT.xview_moveto(fracx)
                except Exception:
                    pass
            finally:
                self._syncing_select = False

        def on_left_select(event=None):
            sync_from_to(self.left_sheet, self.right_sheet)

        def on_right_select(event=None):
            sync_from_to(self.right_sheet, self.left_sheet)

        # ë§ˆìš°ìŠ¤ í´ë¦­/ë“œë˜ê·¸/í‚¤ë³´ë“œ ì´ë™ í›„ ë™ê¸°í™”
        for ev in ("<ButtonRelease-1>", "<KeyRelease>", "<B1-Motion>"):
            self.left_sheet.MT.bind(ev, on_left_select, add=True)
            self.right_sheet.MT.bind(ev, on_right_select, add=True)

        # ìŠ¤í¬ë¡¤ íœ ë¡œ ì´ë™ ì‹œì—ë„ ë°˜ì˜
        def sync_scroll_from_to(source_sheet, target_sheet, axis="y"):
            if self._syncing_scroll:
                return
            self._syncing_scroll = True
            try:
                if axis == "y":
                    start, _ = source_sheet.MT.yview()
                    target_sheet.MT.yview_moveto(start)
                else:
                    start, _ = source_sheet.MT.xview()
                    target_sheet.MT.xview_moveto(start)
            finally:
                self._syncing_scroll = False

        def on_left_wheel(event=None):
            self.root.after_idle(lambda: sync_scroll_from_to(self.left_sheet, self.right_sheet, "y"))

        def on_right_wheel(event=None):
            self.root.after_idle(lambda: sync_scroll_from_to(self.right_sheet, self.left_sheet, "y"))

        def on_left_shift_wheel(event=None):
            self.root.after_idle(lambda: sync_scroll_from_to(self.left_sheet, self.right_sheet, "x"))

        def on_right_shift_wheel(event=None):
            self.root.after_idle(lambda: sync_scroll_from_to(self.right_sheet, self.left_sheet, "x"))

        self.left_sheet.MT.bind("<MouseWheel>", on_left_wheel, add=True)
        self.right_sheet.MT.bind("<MouseWheel>", on_right_wheel, add=True)
        self.left_sheet.MT.bind("<Shift-MouseWheel>", on_left_shift_wheel, add=True)
        self.right_sheet.MT.bind("<Shift-MouseWheel>", on_right_shift_wheel, add=True)

        # tksheet ìì²´ ì´ë²¤íŠ¸ë„ í•¨ê»˜ ë°”ì¸ë”©(ë²„ì „ë³„ í˜¸í™˜ì„±)
        for ev in ("cell_select", "row_select", "column_select", "shift_cell_select", "drag_select"):
            self.left_sheet.extra_bindings(ev,  lambda payload: on_left_select())
            self.right_sheet.extra_bindings(ev, lambda payload: on_right_select())

    # =============== íŒŒì¼ ë¡œë“œ ===============
    def load_left(self):
        path = filedialog.askopenfilename(filetypes=[("Excel files", "*.xls *.xlsx")])
        if not path:
            return
        try:
            # ì›ë³¸ ë°ì´í„°ê°€ B2ë¶€í„° ì‹œì‘í•˜ë¯€ë¡œ ì²« í–‰/ì²« ì—´ì„ ì œì™¸
            df = pd.read_excel(path, sheet_name=0, header=None, dtype=str).fillna("")
            self.df_left = self._to_b2_region(df)
        except Exception as e:
            messagebox.showerror("ì˜¤ë¥˜", f"ì™¼ìª½ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:\n{e}")
            return
        self.left_sheet.set_sheet_data(self.df_left.astype(str).values.tolist())
        self.left_sheet.headers(self._generate_excel_column_headers(self.df_left.shape[1]))
        self.left_sheet.enable_bindings((
            "single_select",
            "drag_select",
            "column_width_resize",
            "row_height_resize",
            "copy",
            "arrowkeys",
        ))
        # ì›ë³¸ ì…€ í¬ê¸° ìœ ì§€ (ìë™ ë¦¬ì‚¬ì´ì¦ˆ ë¹„í™œì„±)
        # ì•Œë¦¼ì°½ ìƒëµ (ìš”ì²­ì‚¬í•­)

    def load_right(self):
        path = filedialog.askopenfilename(filetypes=[("Excel files", "*.xls *.xlsx")])
        if not path:
            return
        try:
            df = pd.read_excel(path, sheet_name=0, header=None, dtype=str).fillna("")
            self.df_right = self._to_b2_region(df)
        except Exception as e:
            messagebox.showerror("ì˜¤ë¥˜", f"ì˜¤ë¥¸ìª½ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:\n{e}")
            return
        self.right_sheet.set_sheet_data(self.df_right.astype(str).values.tolist())
        self.right_sheet.headers(self._generate_excel_column_headers(self.df_right.shape[1]))
        self.right_sheet.enable_bindings((
            "single_select",
            "drag_select",
            "column_width_resize",
            "row_height_resize",
            "copy",
            "arrowkeys",
        ))
        # ì›ë³¸ ì…€ í¬ê¸° ìœ ì§€ (ìë™ ë¦¬ì‚¬ì´ì¦ˆ ë¹„í™œì„±)
        # ì•Œë¦¼ì°½ ìƒëµ (ìš”ì²­ì‚¬í•­)

    # =============== ë¹„êµ ì‹¤í–‰ ===============
    def compare_files(self):
        if self.df_left is None or self.df_right is None:
            messagebox.showwarning("ì•ˆë‚´", "ë‘ íŒŒì¼ì„ ëª¨ë‘ ë¶ˆëŸ¬ì˜¨ í›„ ë¹„êµë¥¼ ì§„í–‰í•˜ì„¸ìš”.")
            return

        rows = min(len(self.df_left), len(self.df_right))
        cols = min(len(self.df_left.columns), len(self.df_right.columns))
        diff_count = 0

        for i in range(rows):
            for j in range(cols):
                val_a = str(self.df_left.iat[i, j])
                val_b = str(self.df_right.iat[i, j])
                if val_a != val_b:
                    diff_count += 1
                    self.left_sheet.highlight_cells(row=i, column=j, bg="lightgreen")
                    self.right_sheet.highlight_cells(row=i, column=j, bg="lightgreen")

        messagebox.showinfo("ë¹„êµ ì™„ë£Œ", f"ê°’ì´ ë‹¤ë¥¸ ì…€ ìˆ˜: {diff_count}")


if __name__ == "__main__":
    root = tk.Tk()
    app = ExcelComparatorApp(root)
    root.mainloop()



ë‹¤ë¥¸ ë²„ì „ì„

import tkinter as tk
from tkinter import filedialog, messagebox
from tksheet import Sheet
import pandas as pd
import openpyxl
import xlrd
from openpyxl import Workbook
import os


# ============================================
# ğŸ”¹ ì˜¤ë˜ëœ .xls â†’ .xlsx ìë™ ë³€í™˜ í•¨ìˆ˜
# ============================================
def convert_xls_to_xlsx(xls_path):
    """ì˜¤ë˜ëœ .xls íŒŒì¼ì„ openpyxlì—ì„œ ì½ì„ ìˆ˜ ìˆëŠ” .xlsxë¡œ ë³€í™˜"""
    wb_xls = xlrd.open_workbook(xls_path)
    sheet = wb_xls.sheet_by_index(0)

    wb_xlsx = Workbook()
    ws_xlsx = wb_xlsx.active

    for r in range(sheet.nrows):
        for c in range(sheet.ncols):
            ws_xlsx.cell(row=r + 1, column=c + 1).value = sheet.cell_value(r, c)

    new_path = os.path.splitext(xls_path)[0] + "_converted.xlsx"
    wb_xlsx.save(new_path)
    return new_path


# ============================================
# ğŸ”¹ ì—‘ì…€ ë¹„êµ GUI
# ============================================
class ExcelComparatorApp:
    def __init__(self, root):
        self.root = root
        self.root.title("ì—‘ì…€ ë¹„êµ ë·°ì–´ (ì •í™•í•œ B2 ê¸°ì¤€)")
        self.root.geometry("1700x850")

        self.df_left = None
        self.df_right = None
        self._syncing_scroll = False
        self._syncing_select = False

        # â”€ ìƒë‹¨ ë²„íŠ¼ â”€
        top = tk.Frame(root)
        top.pack(pady=10)

        tk.Button(top, text="ğŸ“‚ ì²« ë²ˆì§¸ íŒŒì¼ ì—´ê¸°", command=self.load_left,
                  bg="#3C91E6", fg="white", width=20).grid(row=0, column=0, padx=8)
        tk.Button(top, text="ğŸ“‚ ë‘ ë²ˆì§¸ íŒŒì¼ ì—´ê¸°", command=self.load_right,
                  bg="#3C91E6", fg="white", width=20).grid(row=0, column=1, padx=8)
        tk.Button(top, text="ğŸ” ë¹„êµ ì‹œì‘", command=self.compare_files,
                  bg="#4CAF50", fg="white", width=18).grid(row=0, column=2, padx=8)

        # â”€ ì‹œíŠ¸ ì˜ì—­ â”€
        frame = tk.Frame(root)
        frame.pack(padx=10, pady=10, fill="both", expand=True)

        self.left_sheet = Sheet(frame, width=830, height=720)
        self.right_sheet = Sheet(frame, width=830, height=720)
        self.left_sheet.grid(row=0, column=0, sticky="nsew", padx=5)
        self.right_sheet.grid(row=0, column=1, sticky="nsew", padx=5)

        frame.grid_rowconfigure(0, weight=1)
        frame.grid_columnconfigure(0, weight=1)
        frame.grid_columnconfigure(1, weight=1)

        # â”€ ë™ê¸°í™” ì„¤ì • â”€
        self._install_sync_scroll()
        self._install_sync_selection()

    # ============================================
    # ğŸ”¹ ì—‘ì…€ ë°ì´í„° B2ë¶€í„° ë¶ˆëŸ¬ì˜¤ê¸°
    # ============================================
    def _load_b2_from_excel(self, path):
        wb = openpyxl.load_workbook(path, data_only=True)
        ws = wb.active

        # ì—‘ì…€ ì¢Œí‘œ ê¸°ì¤€ìœ¼ë¡œ B2ë¶€í„° ì½ê¸°
        data = []
        for row in ws.iter_rows(min_row=2, min_col=2, values_only=True):
            values = [cell if cell is not None else "" for cell in row]
            # ì™„ì „íˆ ë¹ˆ í–‰ ì œì™¸
            if any(values):
                data.append(values)

        if not data:
            raise ValueError("B2 ì´í›„ì— ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.")

        df = pd.DataFrame(data)
        # ì™„ì „íˆ ë¹ˆ ì—´ ì œê±°
        df = df.dropna(how="all", axis=1)
        return df.reset_index(drop=True)

    # ============================================
    # ğŸ”¹ ìŠ¤í¬ë¡¤ ë™ê¸°í™”
    # ============================================
    def _install_sync_scroll(self):
        def sync_y(src, tgt):
            def wrapper(*args):
                src(*args)
                try:
                    start, _ = src()
                    if not self._syncing_scroll:
                        self._syncing_scroll = True
                        tgt("moveto", start)
                        self._syncing_scroll = False
                except Exception:
                    pass
            return wrapper

        def sync_x(src, tgt):
            def wrapper(*args):
                src(*args)
                try:
                    start, _ = src()
                    if not self._syncing_scroll:
                        self._syncing_scroll = True
                        tgt("moveto", start)
                        self._syncing_scroll = False
                except Exception:
                    pass
            return wrapper

        self._left_yview_orig = self.left_sheet.MT.yview
        self._right_yview_orig = self.right_sheet.MT.yview
        self._left_xview_orig = self.left_sheet.MT.xview
        self._right_xview_orig = self.right_sheet.MT.xview

        self.left_sheet.MT.yview = sync_y(self._left_yview_orig, self.right_sheet.MT.yview_moveto)
        self.right_sheet.MT.yview = sync_y(self._right_yview_orig, self.left_sheet.MT.yview_moveto)
        self.left_sheet.MT.xview = sync_x(self._left_xview_orig, self.right_sheet.MT.xview_moveto)
        self.right_sheet.MT.xview = sync_x(self._right_xview_orig, self.left_sheet.MT.xview_moveto)

    # ============================================
    # ğŸ”¹ ì…€ ì„ íƒ ë™ê¸°í™”
    # ============================================
    def _install_sync_selection(self):
        def sync_from_to(source, target):
            if self._syncing_select:
                return
            selected = source.get_currently_selected()
            if not selected or len(selected) < 2:
                return
            r, c = selected[0], selected[1]
            self._syncing_select = True
            try:
                target.select_cell(r, c, redraw=True)
                target.see(r, c)
            finally:
                self._syncing_select = False

        def on_left_select(event=None):
            sync_from_to(self.left_sheet, self.right_sheet)

        def on_right_select(event=None):
            sync_from_to(self.right_sheet, self.left_sheet)

        for ev in ("<ButtonRelease-1>", "<KeyRelease>", "<B1-Motion>"):
            self.left_sheet.MT.bind(ev, on_left_select, add=True)
            self.right_sheet.MT.bind(ev, on_right_select, add=True)

    # ============================================
    # ğŸ”¹ íŒŒì¼ ë¶ˆëŸ¬ì˜¤ê¸° (.xls ìë™ ë³€í™˜ + B2ê¸°ì¤€)
    # ============================================
    def load_left(self):
        path = filedialog.askopenfilename(filetypes=[("Excel files", "*.xls *.xlsx")])
        if not path:
            return

        if path.lower().endswith(".xls"):
            try:
                path = convert_xls_to_xlsx(path)
            except Exception as e:
                messagebox.showerror("ì˜¤ë¥˜", f"íŒŒì¼ ë³€í™˜ ì‹¤íŒ¨:\n{e}")
                return

        try:
            self.df_left = self._load_b2_from_excel(path)
        except Exception as e:
            messagebox.showerror("ì˜¤ë¥˜", f"ì™¼ìª½ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:\n{e}")
            return

        self.left_sheet.set_sheet_data(self.df_left.astype(str).values.tolist())
        self.left_sheet.headers(self._generate_headers(self.df_left.shape[1]))
        self.left_sheet.enable_bindings((
            "single_select", "drag_select", "copy", "arrowkeys"
        ))
        # ìë™ ë¦¬ì‚¬ì´ì¦ˆ ë¹„í™œì„±: ì›ë³¸ í¬ê¸° ìœ ì§€

    def load_right(self):
        path = filedialog.askopenfilename(filetypes=[("Excel files", "*.xls *.xlsx")])
        if not path:
            return

        if path.lower().endswith(".xls"):
            try:
                path = convert_xls_to_xlsx(path)
            except Exception as e:
                messagebox.showerror("ì˜¤ë¥˜", f"íŒŒì¼ ë³€í™˜ ì‹¤íŒ¨:\n{e}")
                return

        try:
            self.df_right = self._load_b2_from_excel(path)
        except Exception as e:
            messagebox.showerror("ì˜¤ë¥˜", f"ì˜¤ë¥¸ìª½ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:\n{e}")
            return

        self.right_sheet.set_sheet_data(self.df_right.astype(str).values.tolist())
        self.right_sheet.headers(self._generate_headers(self.df_right.shape[1]))
        self.right_sheet.enable_bindings((
            "single_select", "drag_select", "copy", "arrowkeys"
        ))
        # ìë™ ë¦¬ì‚¬ì´ì¦ˆ ë¹„í™œì„±: ì›ë³¸ í¬ê¸° ìœ ì§€

    # ============================================
    # ğŸ”¹ ì—´ í—¤ë” ìë™ ìƒì„± (A,B,C...)
    # ============================================
    @staticmethod
    def _generate_headers(num_columns):
        headers = []
        for i in range(1, num_columns + 1):
            n, s = i, ""
            while n > 0:
                n, rem = divmod(n - 1, 26)
                s = chr(65 + rem) + s
            headers.append(s)
        return headers

    # ============================================
    # ğŸ”¹ ë¹„êµ ì‹¤í–‰
    # ============================================
    def compare_files(self):
        if self.df_left is None or self.df_right is None:
            messagebox.showwarning("ì•ˆë‚´", "ë‘ íŒŒì¼ì„ ëª¨ë‘ ë¶ˆëŸ¬ì˜¨ í›„ ë¹„êµë¥¼ ì§„í–‰í•˜ì„¸ìš”.")
            return

        rows = min(len(self.df_left), len(self.df_right))
        cols = min(len(self.df_left.columns), len(self.df_right.columns))
        diff_count = 0

        for i in range(rows):
            for j in range(cols):
                val_a = str(self.df_left.iat[i, j])
                val_b = str(self.df_right.iat[i, j])
                if val_a != val_b:
                    diff_count += 1
                    self.left_sheet.highlight_cells(row=i, column=j, bg="lightgreen")
                    self.right_sheet.highlight_cells(row=i, column=j, bg="lightgreen")

        messagebox.showinfo("ë¹„êµ ì™„ë£Œ", f"ê°’ì´ ë‹¤ë¥¸ ì…€ ìˆ˜: {diff_count}")


# ============================================
# ğŸ”¹ ì‹¤í–‰ë¶€
# ============================================
if __name__ == "__main__":
    root = tk.Tk()
    app = ExcelComparatorApp(root)
    root.mainloop()



